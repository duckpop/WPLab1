<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<div th:fragment="dishesList" class="w-100">
    <div class="container-fluid p-4">

        <!-- Chef Info Header -->
        <div class="alert alert-info mb-4" th:if="${selectedChef}">
            <h4>
                Chef: <strong th:text="${selectedChef.firstName} + ' ' + ${selectedChef.lastName}"></strong>
                <span class="badge bg-primary" th:text="'ID: ' + ${selectedChef.id}"></span>
            </h4>
        </div>

        <!-- Error message -->
        <div th:if="${error}" class="alert alert-danger">
            <span th:text="${error}"></span>
        </div>

        <!-- Filter Form -->
        <form th:action="@{/dish}" method="get" class="row g-3 mb-4">
            <div class="col-md-3">
                <input type="text" name="SearchName" class="form-control"
                       th:value="${nameOrCuisine}" placeholder="Dish name or cuisine">
            </div>
            <div class="col-md-2">
                <input type="number" name="preparationTime" class="form-control"
                       th:value="${preparationTime}" placeholder="Prep time (min)">
            </div>
            <div class="col-md-2">
                <select name="rank" class="form-select">
                    <option value="">All Ranks</option>
                    <option th:each="r : ${ranks}" th:value="${r}" th:text="${r}"
                            th:selected="${rank == r}"></option>
                </select>
            </div>
            <div class="col-md-2">
                <input type="number" name="rating" class="form-control" step="0.1"
                       th:value="${rating}" placeholder="Rating">
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100">Filter Dishes</button>
            </div>
        </form>

        <!-- Add Dish button - only ADMIN -->
        <div class="mb-4" sec:authorize="hasRole('ADMIN')">
            <a th:href="@{/dishes/dish-form}" class="btn btn-success">
                <i class="fas fa-plus"></i> Add New Dish
            </a>
        </div>

        <!-- Select Dish with Radio Buttons -->
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">Select a Dish to View Chef Details</h5>
            </div>
            <div class="card-body">
                <form th:action="@{/chefDetails}" method="post" id="dishSelectForm">
                    <!-- Hidden field to send chef ID -->
                    <input type="hidden" name="chefId" th:value="${selectedChef.id}">

                    <div th:if="${!dishes.isEmpty()}">
                        <div class="row">
                            <div th:each="dish : ${dishes}" class="col-md-6 mb-3">
                                <div class="form-check">
                                    <input class="form-check-input"
                                           type="radio"
                                           name="dishId"
                                           th:value="${dish.dishId}"
                                           th:id="'dish_' + ${dish.ID}">
                                    <label class="form-check-label" th:for="'dish_' + ${dish.ID}">
                                        <strong th:text="${dish.name}"></strong>
                                        <span class="badge bg-secondary" th:text="${dish.dishId}"></span>
                                        <br>
                                        <small class="text-muted" th:text="${dish.cuisine} + ' â€¢ ' + ${dish.preparationTime} + ' min'"></small>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Submit button -->
                        <div class="mt-3">
                            <button type="submit" class="btn btn-warning">
                                <i class="fas fa-arrow-right"></i> Go to Chef Details
                            </button>
                        </div>
                    </div>

                    <div th:if="${dishes.isEmpty()}" class="alert alert-info">
                        <p>No dishes available for this chef.</p>
                    </div>
                </form>
            </div>
        </div>

<!--        &lt;!&ndash; Dishes Table &ndash;&gt;-->
<!--        <h4 class="mt-4 mb-3">All Dishes</h4>-->
<!--        <div class="table-responsive">-->
<!--            <table class="table table-striped table-hover">-->
<!--                <thead class="table-dark">-->
<!--                <tr>-->
<!--                    <th>ID</th>-->
<!--                    <th>Dish ID</th>-->
<!--                    <th>Name</th>-->
<!--                    <th>Cuisine</th>-->
<!--                    <th>Prep Time</th>-->
<!--                    <th>Rank</th>-->
<!--                    <th>Rating</th>-->
<!--                    <th sec:authorize="hasRole('ADMIN')">Actions</th>-->
<!--                </tr>-->
<!--                </thead>-->
<!--                <tbody>-->
<!--                <tr th:each="dish : ${dishes}">-->
<!--                    <td th:text="${dish.ID}"></td>-->
<!--                    <td th:text="${dish.dishId}"></td>-->
<!--                    <td th:text="${dish.name}"></td>-->
<!--                    <td th:text="${dish.cuisine}"></td>-->
<!--                    <td th:text="${dish.preparationTime} + ' min'"></td>-->
<!--                    <td th:text="${dish.rank}"></td>-->
<!--                    <td th:text="${dish.rating}"></td>-->

<!--                    &lt;!&ndash; Actions - only ADMIN &ndash;&gt;-->
<!--                    <td sec:authorize="hasRole('ADMIN')">-->
<!--                        <a th:href="@{/dishes/dish-form/{id}(id=${dish.ID})}"-->
<!--                           class="btn btn-sm btn-warning">-->
<!--                            <i class="fas fa-edit"></i> Edit-->
<!--                        </a>-->
<!--                        <form th:action="@{/dishes/delete/{id}(id=${dish.ID})}"-->
<!--                              method="post"-->
<!--                              style="display: inline;">-->
<!--                            <button type="submit"-->
<!--                                    class="btn btn-sm btn-danger"-->
<!--                                    onclick="return confirm('Delete this dish?')">-->
<!--                                <i class="fas fa-trash"></i> Delete-->
<!--                            </button>-->
<!--                        </form>-->
<!--                    </td>-->
<!--                </tr>-->
<!--                </tbody>-->
<!--            </table>-->
<!--        </div>-->

        <!-- Empty state -->
        <div th:if="${dishes.isEmpty()}" class="text-center py-5">
            <h4>No dishes found</h4>
            <p sec:authorize="hasRole('ADMIN')">
                <a th:href="@{/dishes/dish-form}">Add the first dish</a>
            </p>
        </div>
    </div>
</div>
</html>
